<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Settings</title>
    
    <link rel="stylesheet" href="../assets/styles/global.css">
    <link rel="stylesheet" type="text/css" href="../assets/styles/notie.min.css">
    <link rel="stylesheet" href="../assets/styles/style.css">
    <link rel="stylesheet" href="../assets/styles/setting.css">
    <!-- Add Bootstrap Icons for modern icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>

<body>
    <div class="settings-container">
        <!-- Modern Sidebar Navigation -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="app-info">
                    <i class="bi bi-gear-fill"></i>
                    <h1>Settings</h1>
                </div>
                <div class="version-info">
                    <span id="app-version"></span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <a href="#general" class="nav-item active" data-tab="general">
                    <i class="bi bi-sliders"></i>
                    <span>General</span>
                </a>
                <a href="#keyboard" class="nav-item" data-tab="keyboard">
                    <i class="bi bi-keyboard"></i>
                    <span>Keyboard</span>
                </a>
                <a href="#shortcut" class="nav-item" data-tab="shortcut">
                    <i class="bi bi-lightning"></i>
                    <span>Shortcuts</span>
                </a>
                <a href="#update" class="nav-item" data-tab="update">
                    <i class="bi bi-arrow-clockwise"></i>
                    <span>Updates</span>
                </a>
            </nav>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- General Tab -->
            <div id="general" class="tab-content active">
                <div class="tab-header">
                    <h2><i class="bi bi-sliders"></i> General Settings</h2>
                    <p>Configure basic application behavior and preferences</p>
                </div>

                <div class="settings-grid">
                    <div class="setting-card">
                        <div class="setting-info">
                            <div class="setting-icon">
                                <i class="bi bi-save"></i>
                            </div>
                            <div class="setting-details">
                                <h3>Auto Save Settings</h3>
                                <p>Automatically save settings to the control panel</p>
                            </div>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="switch-save-setting" />
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="setting-card">
                        <div class="setting-info">
                            <div class="setting-icon" id="minimize-icon">
                                <i class="bi bi-window-minimize"></i>
                                <!-- Fallback icon if Bootstrap Icons fail to load -->
                                <span class="fallback-icon">−</span>
                            </div>
                            <div class="setting-details">
                                <h3>Minimize on Play</h3>
                                <p>Minimize window when playback starts</p>
                            </div>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="switch-minimize-on-play" />
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Keyboard Tab -->
            <div id="keyboard" class="tab-content">
                <div class="tab-header">
                    <h2><i class="bi bi-keyboard"></i> Keyboard Layout</h2>
                    <p>Customize your keyboard mapping for piano keys</p>
                </div>

                <div class="keyboard-container">
                    <div class="keyboard-layout">
                        <table>
                            <tr>
                                <td><span class="key square circle"><input class="keys" maxlength="1" type="text"
                                            value="c"></span></td>
                                <td><span class="key square"><input class="keys" maxlength="1" type="text"
                                            value="d"></span></td>
                                <td><span class="key circle"><input class="keys" maxlength="1" type="text"
                                            value="e"></span></td>
                                <td><span class="key square"><input class="keys" maxlength="1" type="text"
                                            value="f"></span></td>
                                <td><span class="key circle"><input class="keys" maxlength="1" type="text"
                                            value="g"></span></td>
                            </tr>
                            <tr>
                                <td><span class="key circle"><input class="keys" maxlength="1" type="text"
                                            value="c"></span></td>
                                <td><span class="key square"><input class="keys" maxlength="1" type="text"
                                            value="d"></span></td>
                                <td><span class="key square circle"><input class="keys" maxlength="1" type="text"
                                            value="e"></span></td>
                                <td><span class="key square"><input class="keys" maxlength="1" type="text"
                                            value="f"></span></td>
                                <td><span class="key circle"><input class="keys" maxlength="1" type="text"
                                            value="g"></span></td>
                            </tr>
                            <tr>
                                <td><span class="key circle"><input class="keys" maxlength="1" type="text"
                                            value="c"></span></td>
                                <td><span class="key square"><input class="keys" maxlength="1" type="text"
                                            value="d"></span></td>
                                <td><span class="key circle"><input class="keys" maxlength="1" type="text"
                                            value="e"></span></td>
                                <td><span class="key square"><input class="keys" maxlength="1" type="text"
                                            value="f"></span></td>
                                <td><span class="key square circle"><input class="keys" maxlength="1" type="text"
                                            value="g"></span></td>
                            </tr>
                        </table>
                    </div>

                    <div class="setting-card">
                        <div class="setting-info">
                            <div class="setting-icon">
                                <i class="bi bi-palette"></i>
                            </div>
                            <div class="setting-details">
                                <h3>Custom Keyboard</h3>
                                <p>Use custom keyboard mapping instead of default layout</p>
                            </div>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="switch-custom-keyboard" />
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Shortcuts Tab -->
            <div id="shortcut" class="tab-content">
                <div class="tab-header">
                    <h2><i class="bi bi-lightning"></i> Keyboard Shortcuts</h2>
                    <p>Configure global shortcuts for quick access to features</p>
                </div>

                <div class="shortcuts-grid">
                    <div class="shortcut-item">
                        <div class="shortcut-info">
                            <i class="bi bi-skip-backward"></i>
                            <span>Previous Song</span>
                        </div>
                        <input type="text" id="pre-shortcut-setting" name="pre-shortcut" value="Ctrl+Shift+C" readonly>
                    </div>

                    <div class="shortcut-item">
                        <div class="shortcut-info">
                            <i class="bi bi-play-circle"></i>
                            <span>Play Current Song</span>
                        </div>
                        <input type="text" id="play-shortcut-setting" name="play-shortcut" value="Ctrl+Shift+V"
                            readonly>
                    </div>

                    <div class="shortcut-item">
                        <div class="shortcut-info">
                            <i class="bi bi-skip-forward"></i>
                            <span>Next Song</span>
                        </div>
                        <input type="text" id="next-shortcut-setting" name="next-shortcut" value="Ctrl+Shift+B"
                            readonly>
                    </div>

                    <div class="shortcut-item">
                        <div class="shortcut-info">
                            <i class="bi bi-eye"></i>
                            <span>Show/Hide App</span>
                        </div>
                        <input type="text" id="show_app-shortcut-setting" name="show_app-shortcut" value="Alt+Tab"
                            readonly>
                    </div>

                    <div class="shortcut-item">
                        <div class="shortcut-info">
                            <i class="bi bi-speedometer2"></i>
                            <span>Increase Speed</span>
                        </div>
                        <input type="text" id="increase-speed-shortcut-setting" name="increase-speed-shortcut"
                            value="numadd" readonly>
                    </div>

                    <div class="shortcut-item">
                        <div class="shortcut-info">
                            <i class="bi bi-speedometer"></i>
                            <span>Decrease Speed</span>
                        </div>
                        <input type="text" id="decrease-speed-shortcut-setting" name="decrease-speed-shortcut"
                            value="numsub" readonly>
                    </div>
                </div>
            </div>

            <!-- Update Tab -->
            <div id="update" class="tab-content">
                <div class="tab-header">
                    <h2><i class="bi bi-arrow-clockwise"></i> Updates</h2>
                    <p>Manage application updates and version information</p>
                </div>

                <div class="settings-grid">
                    <div class="setting-card warning-card">
                        <div class="setting-info">
                            <div class="setting-icon warning-icon">
                                <i class="bi bi-exclamation-triangle"></i>
                            </div>
                            <div class="setting-details">
                                <h3>Block Updates</h3>
                                <p>Prevent automatic update checks (Not Recommended)</p>
                                <span class="warning-text">⚠️ This may prevent you from receiving new feature updates
                                    and important bug fixes.</span>
                            </div>
                        </div>
                        <div class="setting-control">
                            <label class="toggle-switch">
                                <input type="checkbox" id="switch-block-update" />
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="update-section">
                    <button id="check-update-btn" class="check-update-btn">
                        <i class="bi bi-arrow-clockwise"></i>
                        <span>Check for Updates</span>
                    </button>

                    <div class="update-status">
                        <span id="update-message" class="update-message"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modern Save Button -->
    <button class="save-button" id="btn-save-setting">
        <i class="bi bi-floppy"></i>
    </button>

    <!-- Update Prompt Dialog -->
    <div id="update-prompt" class="update-prompt">
        <div class="update-prompt-content">
            <div class="update-header">
                <h2>A new update is available!</h2>
                <div class="version-info">
                    <span id="current-version"></span> → <span id="update-version"></span>
                </div>
            </div>

            <div class="changelog">
                <div class="changelog-content" id="changelog-content">
                    <!-- Changelog items will be inserted here dynamically -->
                </div>
            </div>

            <div class="update-prompt-buttons">
                <button id="update-now-btn" class="update-btn primary">
                    <i class="bi bi-download"></i>
                    <span>Update Now</span>
                </button>
                <button id="update-later-btn" class="update-btn secondary">
                    <i class="bi bi-clock"></i>
                    <span>Later</span>
                </button>
            </div>
        </div>
    </div>

    <script type="text/javascript" src="../assets/scripts/notie.js"></script>
    <script type="text/javascript" src="../viewmodels/settingViewModel.js"></script>

    <script>
        // Check if Bootstrap Icons are loaded and show fallback if needed
        function checkBootstrapIcons() {
            const minimizeIcon = document.getElementById('minimize-icon');
            const biIcon = minimizeIcon.querySelector('.bi');

            // Simple check: if the icon element exists but doesn't show content, use fallback
            if (biIcon && biIcon.offsetWidth === 0) {
                minimizeIcon.classList.add('show-fallback');
            }
        }

        // Check when page loads
        document.addEventListener('DOMContentLoaded', function () {
            // Wait for fonts to load
            setTimeout(checkBootstrapIcons, 500);
        });

        // Also check when window loads completely
        window.addEventListener('load', function () {
            setTimeout(checkBootstrapIcons, 100);
        });
    </script>
</body>

</html>